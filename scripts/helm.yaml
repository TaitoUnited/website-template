global:
  domain: ${taito_domain}
  url: https://${taito_domain}
  logFormat: stackdriver
  logLevel: info    # trace, debug, info, warn, error, fatal
  registry: ${taito_image_registry}
  imagePullPolicy: ''

full-stack:
  # TODO: --enable-pod-security-policy:
  # https://cloud.google.com/kubernetes-engine/docs/how-to/pod-security-policies
  podSecurityPolicy:
    enabled: false

  ingress:
    class: nginx
    tls: true
    maxBodySize: 1m
    basicAuth:
      enabled: true
      htpasswdSecret: ${taito_project}-${taito_env}-basic-auth
    domains:
      - name: ${taito_domain}

  serviceDefaults:
    # Basics
    image: # For 3rd party container image
    command:
    path:
    port: 8080
    tier:
    livenessPath: /healthz
    # Security
    runAsUser:
    fsGroup:
    # Resources
    cpuRequest: 2m
    cpuLimit: 100m
    memoryRequest: 50Mi
    memoryLimit: 256Mi
    # Scaling
    replicas: ${kubectl_replicas}
    autoscale: false
    minReplicas: 2
    maxReplicas: 5
    # TODO metrics:
    # https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/
    # TODO vertical autoscaling:
    # https://cloud.google.com/kubernetes-engine/docs/how-to/vertical-pod-autoscaling
    # Env
    env:
      # Environment variables
      COMMON_ENV: ${taito_env}
    secrets:
      # Secrets

  services:

    www:
      path: /
      tier: frontend
      sidecar:
        enabled: false
        name: webhook
        path: /webhook
        port: 9000
        sharedVolume:
          mountPath: /service
          sidecarMountPath: /build
        livenessDisabled: true # TODO
        secretEnv:
          WEBHOOK_URL_PREFIX: ${taito_project}-${taito_env}-webhook.urlprefix
          WEBHOOK_GIT_TOKEN: ${taito_project}-${taito_env}-webhook.gittoken
        env:
          GIT_REPOSITORY_URL: ${taito_vc_repository_url}.git
